# Дампы Томска в wplace.live

Ежедневные таймлапсы из этих дампов можно найти в [репозитории](https://github.com/niklinque/wplace-tomsk-timelapse/releases) и в [телеграм-канале](https://t.me/wplacetomsktimelapse).

Этот репозиторий содержит скрипт для автоматической загрузки и обработки изображений с wplace.live.

## Как это работает

1.  **Настройка области**: В файле `config.py` задаются координаты нужной области: от верхнего левого до нижнего правого тайла, а также точные пиксельные координаты для обрезки.
2.  **Загрузка**: Скрипт `main.py` параллельно загружает все тайлы, входящие в заданную область.
3.  **Обработка**: Загруженные тайлы склеиваются в одно большое изображение.
4.  **Обрезка и масштабирование**: Полученное изображение обрезается по пиксельным координатам, указанным в `config.py`, и при необходимости масштабируется.
5.  **Сохранение**: Готовое изображение сохраняется в папку `output/ГГГГММДД/` с именем файла, содержащим точное время создания.
6.  **Автоматизация**: Процесс запускается с помощью GitHub Actions, который после выполнения скрипта автоматически добавляет (коммитит) новое изображение в репозиторий.

## Структура проекта

-   `main.py`: Основной скрипт, выполняющий всю логику.
-   `config.py`: Здесь вы указываете, какую область карты нужно скачать.
-   `requirements.txt`: Список зависимостей Python.
-   `.github/workflows/download-tiles.yml`: Файл рабочего процесса GitHub Actions для автоматического запуска.
-   `output/`: Директория, куда сохраняются итоговые изображения (дампы).

## Настройка

Основная настройка производится в файле `config.py`.

```python
# config.py

# --- КООРДИНАТЫ ОБЛАСТИ ---

# Координаты тайла и пикселя для ВЕРХНЕГО ЛЕВОГО угла обрезки
TOP_LEFT_TILE_X = 1506  # X-координата тайла
TOP_LEFT_TILE_Y = 631   # Y-координата тайла
TOP_LEFT_PIXEL_X = 0    # X-координата пикселя внутри тайла
TOP_LEFT_PIXEL_Y = 0    # Y-координата пикселя внутри тайла

# Координаты тайла и пикселя для НИЖНЕГО ПРАВОГО угла обрезки
BOTTOM_RIGHT_TILE_X = 1508
BOTTOM_RIGHT_TILE_Y = 633
BOTTOM_RIGHT_PIXEL_X = 1000
BOTTOM_RIGHT_PIXEL_Y = 1000

# --- ДРУГИЕ НАСТРОЙКИ ---
SCALE_FACTOR = 1 # Коэффициент масштабирования (1 = без изменений)

# --- ЧАСОВОЙ ПОЯС ---
TIMEZONE = "Asia/Tomsk" # Для корректных временных меток
```

## Автоматический запуск

Рабочий процесс GitHub Actions настроен на запуск по событию `workflow_dispatch`. Это означает, что его можно запустить либо вручную через интерфейс GitHub, либо через API-запрос.

Для регулярного автоматического запуска (например, каждые 5 минут) можно использовать внешний сервис, такой как [cron-job.org](https://cron-job.org/en/):

1.  **Создайте Fine-grained personal access token** в [настройках GitHub](https://github.com/settings/tokens](https://github.com/settings/personal-access-tokens) с правами `actions` и `workflows` (read and write) для вашего репозитория.
2.  **Настройте cron-задание**:
    -   **URL**: `https://api.github.com/repos/ВАШ_ПОЛЬЗОВАТЕЛЬ/ВАШ_РЕПОЗИТОРИЙ/actions/workflows/download-tiles.yml/dispatches`
    -   **Method**: `POST`
    -   **Тело запроса (JSON)**: `{"ref":"main"}` (или ваша основная ветка)
    -   **Добавьте заголовки (headers)**:
        -   `Authorization`: `token ВАШ_GITHUB_TOKEN`
        -   `Accept`: `application/vnd.github.v3+json`
        -   `User-Agent`: `My-Cron-Job`

## Ручной запуск

1.  Установите зависимости:
    ```bash
    pip install -r requirements.txt
    ```
2.  Настройте `config.py` под свои нужды.
3.  Запустите скрипт:
    ```bash
    python main.py
    ```
